<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <title>Nova Scotia Open Data</title>
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/dashboard.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <!-- Custom styles for this template -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="js/d3.js"></script>
  </head>
  <body data-gr-c-s-loaded="true">
    <nav class="navbar navbar-expand-lg fixed-top flex-md-nowrap p-0" id="top-bar">
      <div class="nav-brand col-sm-3 col-md-2 mr-0">
        <img src="image/nova_scotia_logo.png" width="100%" style="background-color: #F8F9FA">
      </div>
      <ul class="navbar-nav mr-auto" id="menu">
        <li class="nav-item">
          <a class="nav-link" href="#">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Catalogue</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">User's Guide</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Developers</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Survey</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="#">Index Dashboard</a>
        </li>
      </ul>
      <!-- <a class="navbar-brand col-sm-3 col-md-2 mr-0 text-center" href="#">TrajExp</a> -->
      <!-- <input class="form-control form-control-light w-100" type="text" placeholder="Search" aria-label="Search"> -->
    </nav>

    <div class="container-fluid">
      <main role="main" class="px-0" id="main-content">
        <div class="row p-1">
          <div class="col-2" id="left-panel">
            <br><br>
            <a href="#select-index" data-toggle="collapse" role="button"><h6>Select Indicators to View</h6></a>
            <div class="collapse" id="select-index">
              <div class="form-group">
                <div id="select-indices">
                  <div class="row form-group">
                    <div class="col-md-auto">
                      <select class="form-control form-control-sm">
                        <option selected disabled>Select an index</option>
                        <option>Criminality</option>
                        <option>Healthcare</option>
                      </select>
                    </div>
                    <div class="col">
                      <button class="btn btn-sm btn-primary" onclick="addIndex(this)">+</button>
                    </div>
                  </div>
                </div>
              </div>
              <script type="text/javascript">
                function addIndex(btn) {
                  btn.remove('.btn');
                  $('#select-indices').append(`
                    <div class="row form-group">
                      <div class="col-md-auto">
                        <select class="form-control form-control-sm">
                          <option selected disabled>Select an index</option>
                          <option>Criminality</option>
                          <option>Healthcare</option>
                        </select>
                      </div>
                      <div class="col">
                        <button class="btn btn-sm btn-primary" onclick="addIndex(this)">+</button>
                      </div>
                    </div>`);
                }
              </script>
              <div class="row d-flex flex-row-reverse m-2">
                <button class="btn btn-sm btn-primary" onclick="viewIndices(this)">View</button>
              </div>
              <script type="text/javascript">
                function viewIndices(obj) {
                  console.log('View indices!');
                }
              </script>
            </div>
            <br>
            <a href="#create-index" data-toggle="collapse" role="button"><h6>Create an Index</h6></a>
            <div class="collapse" id="create-index">
              <div class="form-group">
                <label class="form-label" id="create-name">Name</label>
                <input class="form-control form-control-sm" id="input-index-name" aria-describedby="nameHelp" placeholder="Enter index name">
              </div>
              <div class="form-group">
                <label class="form-label">Category</label>
                <select class="form-control form-control-sm">
                  <option selected disabled>Select a category</option>
                  <option>Business and Economy</option>
                  <option>Communities and Social Services</option>
                  <option>Government Administration</option>
                  <option>Nature and Environment</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Dataset</label>
                <select class="form-control form-control-sm">
                  <option selected disabled>Select a dataset</option>
                  <option>Crime Statistics - Incidents and rates by offence category</option>
                  <option>Dataset 2</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Variables</label>
                <div id="create-variables">
                  <div class="row form-group">
                    <div class="col-7">
                      <select class="form-control form-control-sm">
                        <option selected disabled>Select a variable</option>
                        <option>Rate Other Criminal Code</option>
                        <option>Rate Property Crime</option>
                        <option>Rate Violent Criminal Code</option>
                      </select>
                    </div>
                    <div class="col-3">
                      <input class="form-control form-control-sm" value="1" maxlength="2">
                    </div>
                    <div class="col-1">
                      <button class="btn btn-sm btn-primary" onclick="addVariable(this)">+</button>
                    </div>
                  </div>
                </div>
              </div>
              <script type="text/javascript">
                function addVariable(btn) {
                  btn.remove('.btn');
                  $('#create-variables').append(`
                    <div class="row form-group">
                      <div class="col-7">
                        <select class="form-control form-control-sm">
                          <option selected disabled>Select a variable</option>
                          <option>Rate Other Criminal Code</option>
                          <option>Rate Property Crime</option>
                          <option>Rate Violent Criminal Code</option>
                        </select>
                      </div>
                      <div class="col-3">
                        <input class="form-control form-control-sm" value="1" maxlength="2">
                      </div>
                      <div class="col-1">
                        <button class="btn btn-sm btn-primary" onclick="addVariable(this)">+</button>
                      </div>
                    </div>`);
                }
              </script>
              <div class="row d-flex flex-row-reverse m-2">
                <button class="btn btn-sm btn-primary" onclick="createIndex(this)">Create</button>
              </div>
              <script type="text/javascript">
                function createIndex(obj) {

                }
              </script>
            </div>
          </div>
          <div class="col-8" id="main-view">
            <br>
            <div class="row" style="text-align: center;">
              <svg id="content" width="700" height="350">

                <g transform="translate(0, 50)">
                  <text x="40" y="-30" class="general-text">
                    <tspan fill="black">County:</tspan>
                    <tspan id="map-county-name" fill="black">NAME</tspan>
                  </text>
                </g>

                <g>
                    <g transform="scale(25,25) ">
                        <g class="map" transform="translate(-300,-122)">
                  </g>
                  </g>
                  <g id="map-legend" transform="translate(600,430)">
                  </g>
                  <text id="map-index-name" transform="translate(250,450)">Index 0</text>
                </g>
              </svg>
              
            </div>
            <div class="row">
              <div class="col-4">
                <svg width="200" height="200">
                    <g id="pie0" class="pie" index="0" transform="translate(50,0)">
                        <text>Index 0</text>
                      </g>
                </svg>
              </div>
              <div class="col-4"><svg width="200" height="200">
                  <g id="pie1" class="pie unfocus" index="1" transform="translate(50,0)">
                      <text>Index 0</text>
                    </g>
              </svg></div>
              <div class="col-4"><svg width="200" height="200">
                  <g id="pie2" class="pie unfocus" index="2" transform="translate(50,0)">
                      <text>Index 0</text>
                    </g>
              </svg></div>
            </div>
          </div>
          <div class="col-2" id="right-panel">
            LEFT SIDEBAR
            <svg width="200" height="400">
                <g id="county-ranking" class="ranking">
                  
                </g>
            </svg>
          </div>
        </div>
      </main>
    </div>
    <script src="js/map.js"></script>
    <script type="text/javascript">
      $(() => {
        var crime_data;
        var criminality_idx = {}

        d3.csv('data/proc/crime_stats_by_offence_category.csv')
          .then((data) => {
            console.log('Crime data loaded!');
            data.forEach((row) => {
              if (!(row.YEAR in criminality_idx)) {
                criminality_idx[row.YEAR] = {
                  name: 'Criminality',
                  params: ['Rate Other Criminal Code',
                           'Rate Property Crime',
                           'Rate Violent Criminal Code'],
                  data: []
                }
              }

              criminality_idx[row.YEAR].data.push({
                name: row.CO_DESC,
                value: 0,
                params: [row[criminality_idx[row.YEAR].params[0]],
                         row[criminality_idx[row.YEAR].params[1]],
                         row[criminality_idx[row.YEAR].params[2]]]
              });
            });
            theMap.indexData[0] = criminality_idx['2017'];
          })
          .catch((err) => {
            console.log(err);
          });
      })
    </script>
  </body>
</html>